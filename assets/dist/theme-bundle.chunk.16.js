(window.webpackJsonpWebpackChiara=window.webpackJsonpWebpackChiara||[]).push([[16],{586:function(t,e,a){"use strict";a.r(e),function(t){var i=a(75),r=a.n(i),n=a(27),o=a.n(n),d=a(705),s=function(){function e(t){var e=void 0===t?{}:t,a=e.cardSelector,i=void 0===a?".product .card, .productCarousel-slide .card":a,n=e.productIdSelector,o=void 0===n?"[data-product-id]":n,d=e.findProductIdByImg,s=void 0!==d&&d,c=e.swatchesContainerSelector,u=void 0===c?".card-text--colorswatches":c,l=e.cardImageSelector,p=void 0===l?".card-image":l,h=e.addToCartFormSelector,m=void 0===h?"form[data-cart-item-add]":h,f=e.productViewFile,v=void 0===f?"products/product-view":f,w=e.attributesTemplate,g=void 0===w?'\n            <div class="productSwatches-attributes">\n                {{#attributes}}\n                    <div class="productSwatches-swatches" data-swatches>\n                        {{#.}}\n                            <a href="#" class="productSwatches-swatches-item" title="{{label}}"\n                                data-attribute-id="{{attributeId}}"\n                                data-attribute-value="{{attributeValue}}">{{&content}}</a>\n                        {{/.}}\n                        <button type="button" class="productSwatches-swatches-more" data-more>+ More</button>\n                        <button type="button" class="productSwatches-swatches-less" data-less>- Less</button>\n                    </div>\n                {{/attributes}}\n            </div>\n        ':w,b=e.templateCustomTags,S=void 0===b?null:b,y=e.imageSize,I=void 0===y?"590x590":y,$=e.inputFinderFunc,x=void 0===$?null:$,C=e.swatchesLimit,T=void 0===C?0:C,F=e.imageReplacerFunc,_=void 0===F?null:F,k=e.displayInStockOnly,O=void 0!==k&&k,L=e.autoSelectOptionValues,W=void 0===L||L,N=e.graphQLToken,V=void 0===N?"":N;this.config={cardSelector:i,productIdSelector:o,findProductIdByImg:s,swatchesContainerSelector:u,cardImageSelector:p,addToCartFormSelector:m,productViewFile:v,attributesTemplate:g,templateCustomTags:S,imageSize:I,inputFinderFunc:x,swatchesLimit:T,imageReplacerFunc:_,displayInStockOnly:O,autoSelectOptionValues:W,graphQLToken:V},this.onWindowScroll=r()(this.onWindowScroll.bind(this,null),200),this.bindEvents()}var a=e.prototype;return a.bindEvents=function(){var e=this;t(window).on("scroll resize load",this.onWindowScroll);var a=window.MutationObserver||window.WebKitMutationObserver;a&&(this.mutationObserver=new a((function(t){var a=t.reduce((function(t,e){return[].concat(t,e.addedNodes)}),[]);e.onWindowScroll(a)})),this.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},a.unbindEvents=function(){t(window).off("scroll resize load",this.onWindowScroll),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)},a.onWindowScroll=function(e){var a=this;void 0===e&&(e=null);var i=[];if(t(this.config.cardSelector,e).each((function(e,r){var n=t(r);if(!n.data("productSwatchesCard")&&o.a.is(r)){var s=n.find(a.config.productIdSelector).data("productId");if(!s){if(!a.config.findProductIdByImg)return;if(!(s=n.find("img").get().reduce((function(t,e){if(t)return t;var a=String(e.src).match(/products\/([0-9]+)\//);return a?Number(a[1]):t}),null)))return}var c=n.find(a.config.swatchesContainerSelector);if(0!==c.length){var u=a.config,l=u.productViewFile,p=u.attributesTemplate,h=u.templateCustomTags,m=u.addToCartFormSelector,f=u.imageSize,v=u.inputFinderFunc,w=u.swatchesLimit,g=u.imageReplacerFunc,b=u.displayInStockOnly,S=u.autoSelectOptionValues,y=u.graphQLToken,I=n.find(a.config.cardImageSelector).first(),$=new d.a({$scope:n,$attributesContainer:c,productId:s,productViewFile:l,attributesTemplate:p,templateCustomTags:h,addToCartFormSelector:m,$cardImage:I,imageSize:f,inputFinderFunc:v,swatchesLimit:w,imageReplacerFunc:g,displayInStockOnly:b,autoSelectOptionValues:S,autoInit:!y});i.push($),n.data("productSwatchesCard",$),n.addClass("productSwatchesLoaded")}}})),this.config.graphQLToken&&i.length>0){var r=i.map((function(t){return t.productId}));t.ajax({url:"/graphql",method:"POST",data:JSON.stringify({query:"\n                        query {\n                            site {\n                                products (entityIds: "+JSON.stringify(r)+", first: "+r.length+") {\n                                    edges {\n                                        node {\n                                            entityId\n                                            name\n                                            minPurchaseQuantity\n                                            productOptions {\n                                                edges {\n                                                    node {\n                                                        entityId\n                                                        displayName\n                                                        ... on CheckboxOption {\n                                                            checkedByDefault\n                                                        }\n                                                        ... on MultipleChoiceOption {\n                                                            values {\n                                                                edges {\n                                                                    node {\n                                                                        entityId\n                                                                        isDefault\n                                                                        ... on SwatchOptionValue {\n                                                                            label\n                                                                            hexColors\n                                                                            imageUrl(width: 100)\n                                                                        }\n                                                                    }\n                                                                }\n                                                            }\n                                                        }\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.config.graphQLToken},xhrFields:{withCredentials:!0},success:function(t){t.data.site.products.edges.forEach((function(t){i.filter((function(e){return e.productId==t.node.entityId})).forEach((function(e){e.graphQLNode=t.node,e.init()}))}))}})}},e}();e.default=s}.call(this,a(4))},705:function(t,e,a){"use strict";(function(t){var i=a(37),r=a.n(i);function n(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return(a=a.call(t)).next.bind(a);if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}var d=function(){function e(t){var e=t.$scope,a=t.$attributesContainer,i=t.productId,r=t.productViewFile,n=t.attributesTemplate,o=t.templateCustomTags,d=t.addToCartFormSelector,s=t.$cardImage,c=t.imageSize,u=t.inputFinderFunc,l=t.swatchesLimit,p=t.imageReplacerFunc,h=t.displayInStockOnly,m=t.autoSelectOptionValues,f=t.autoInit,v=void 0===f||f,w=t.graphQLNode;this.$scope=e,this.productId=i,this.$attributesContainer=a,this.productViewFile=r,this.attributesTemplate=n,this.templateCustomTags=o,this.addToCartFormSelector=d,this.$cardImage=s,this.imageSize=c,this.inputFinderFunc=u,this.swatchesLimit=l,this.imageReplacerFunc=p,this.displayInStockOnly=h,this.autoSelectOptionValues=m,this.autoInit=v,this.graphQLNode=w,this.autoInit&&this.init()}var a=e.prototype;return a.init=function(){this.displayInStockOnly?this.requestInStockAttributes():this.graphQLNode?this.buildProductOptions():this.requestProductOptions()},a.requestInStockAttributes=function(){var e=this;t.ajax({url:"/remote/v1/product-attributes/"+this.productId,method:"POST",data:{action:"add",product_id:this.productId},headers:{"stencil-config":"{}","stencil-options":"{}","x-xsrf-token":window.BCData&&window.BCData.csrf_token?window.BCData.csrf_token:""},xhrFields:{withCredentials:!0},success:function(t){var a=t.data||{};("object"==typeof a.in_stock_attributes||a.instock)&&(e.graphQLNode?e.buildProductOptions(a):e.requestProductOptions(a))}})},a.requestProductOptions=function(e){var a=this;t.ajax({url:"/products.php?productId="+this.productId,method:"GET",headers:{"stencil-config":"{}","stencil-options":'{"render_with":"'+this.productViewFile+'"}',"x-xsrf-token":window.BCData&&window.BCData.csrf_token?window.BCData.csrf_token:""},xhrFields:{withCredentials:!0},success:function(t){a.buildProductOptions(e,t)}})},a.buildProductOptions=function(e,a){var i=this;void 0===e&&(e={});var n={attributes:[]};if(this.graphQLNode?n.attributes=this.graphQLNode.productOptions.edges.reduce((function(t,a){var i=a.node;if(i.values){var r=i.values.edges.reduce((function(t,a){var r=a.node;return("object"!=typeof e.in_stock_attributes||e.in_stock_attributes.indexOf(r.entityId)>-1)&&(r.imageUrl||r.hexColors)&&t.push({content:r.imageUrl?'<span class="form-option-variant form-option-variant--pattern" title="'+r.label+'" style="background-image: url(\''+r.imageUrl+"');\"></span>":r.hexColors.map((function(t){return"<span class='form-option-variant form-option-variant--color' title=\""+r.label+'" style="background-color: '+t+'"></span>'})).join(""),label:r.label,attributeId:i.entityId,attributeValue:r.entityId}),t}),[]);r.length>0&&t.push(r)}return t}),[]):t(a).find('[data-product-attribute="swatch"]').each((function(a,r){var o=t(r),d=[];o.find("[data-product-attribute-value]").each((function(a,r){var n=t(r),s=i.inputFinderFunc?i.inputFinderFunc(o,n):o.find('[id="'+n.attr("for")+'"]'),c=Number(s.attr("value")),u=Number(s.attr("name").replace(/attribute\[([0-9]+)\]/,"$1"));("object"!=typeof e.in_stock_attributes||e.in_stock_attributes.indexOf(c)>-1)&&d.push({content:n.html(),label:s.data("productAttributeLabel"),attributeId:u,attributeValue:c})})),d.length>0&&n.attributes.push(d)})),0!==n.attributes.length){var o,d=r.a.render(this.attributesTemplate,n,null,this.templateCustomTags);if(this.$attributesContainer.append(d),this.graphQLNode)(o=t('<form class="productSwatches-hiddenForm"></form>').hide()).append('<input type="hidden" name="action" value="add">'),o.append('<input type="hidden" name="product_id" value="'+this.productId+'">'),o.append('<input type="hidden" name="qty[]" value="'+(this.graphQLNode.minPurchaseQuantity||1)+'">'),this.graphQLNode.productOptions.edges.forEach((function(t){var a=t.node,r="";a.values?(r=i.autoSelectOptionValues&&a.values.edges.length>0?a.values.edges[0].node.entityId:"",!(r=a.values.edges.reduce((function(t,e){var a=e.node;return a.isDefault?a.entityId:t}),r))&&e&&e.in_stock_attributes&&(r=a.values.edges.reduce((function(t,a){var i=a.node;return t||(e.in_stock_attributes.indexOf(i.entityId)>-1?i.entityId:"")}),""))):a.checkedByDefault&&(r=1),o.append('<input type="hidden" name="attribute['+a.entityId+']" value="'+r+'">')}));else t("<div></div>").append(a).find(this.addToCartFormSelector).addClass("productSwatches-hiddenForm").hide().find("[id]").prop("id",null);this.$attributesContainer.append(o),this.$attributesContainer.on("click","[data-attribute-id]",(function(e){e.preventDefault();var a=t(e.currentTarget),r=a.data("attributeId"),n=a.data("attributeValue");i.$attributesContainer.find("[data-attribute-id="+r+"]").removeClass("is-active").find("input").prop("checked",!1),a.addClass("is-active").find("input").prop("checked",!0),o.find('[name="attribute['+r+']"]').val([n]),i.requestAttributesChange(o)})),this.swatchesLimit?this.$attributesContainer.find("[data-more]").each((function(e,a){var r=t(a),n=r.closest("[data-swatches]"),o=n.find("[data-less]"),d=n.find("[data-attribute-id]");if(d.length>i.swatchesLimit){var s=d.filter((function(t){return t>=i.swatchesLimit})).hide();r.on("click",(function(){s.show(),r.hide(),o.show()})),o.on("click",(function(){s.hide(),o.hide(),r.show()}))}else r.hide();o.hide()})):this.$attributesContainer.find("[data-more], [data-less]").hide()}},a.requestAttributesChange=function(e){var a=this;if(window.FormData){var i=this.filterEmptyFilesFromForm(new FormData(e.get(0)));t.ajax({url:"/remote/v1/product-attributes/"+this.productId,method:"POST",contentType:!1,processData:!1,data:i,headers:{"stencil-config":"{}","stencil-options":"{}","x-xsrf-token":window.BCData&&window.BCData.csrf_token?window.BCData.csrf_token:""},xhrFields:{withCredentials:!0},success:function(t){var e=t.data,i=e.image,r=e.price;if(a.imageReplacerFunc){var n=i?i.data.replace("{:size}",a.imageSize):null;a.imageReplacerFunc(a.$cardImage,n)}else if(i){var o=i.data.replace("{:size}",a.imageSize);a.$cardImage.data("originalSrc")||a.$cardImage.data("originalSrc",a.$cardImage.attr("src")).data("originalSrcset",a.$cardImage.attr("srcset")),a.$cardImage.attr("src",o).attr("srcset","").attr("data-srcset","").addClass("productSwatches-image-optionChanged")}else a.$cardImage.data("originalSrc")&&a.$cardImage.attr("src",a.$cardImage.data("originalSrc")).attr("srcset",a.$cardImage.data("originalSrcset")).attr("data-srcset",a.$cardImage.data("originalSrcset")).data("originalSrc",null).data("originalSrcset",null).removeClass("productSwatches-image-optionChanged");if(r){var d=a.getViewModel(a.$scope);a.updatePriceView(d,r)}}})}},a.filterEmptyFilesFromForm=function(t){try{for(var e,a=n(t);!(e=a()).done;){var i=e.value,r=i[0],o=i[1];o instanceof File&&!o.name&&!o.size&&t.delete(r)}}catch(t){console.error(t)}return t},a.getViewModel=function(e){return{$priceWithTax:t("[data-product-price-with-tax]",e),$priceWithoutTax:t("[data-product-price-without-tax]",e),rrpWithTax:{$div:t(".rrp-price--withTax",e),$span:t("[data-product-rrp-with-tax]",e)},rrpWithoutTax:{$div:t(".rrp-price--withoutTax",e),$span:t("[data-product-rrp-price-without-tax]",e)},nonSaleWithTax:{$div:t(".non-sale-price--withTax",e),$span:t("[data-product-non-sale-price-with-tax]",e)},nonSaleWithoutTax:{$div:t(".non-sale-price--withoutTax",e),$span:t("[data-product-non-sale-price-without-tax]",e)},priceSaved:{$div:t(".price-section--saving",e),$span:t("[data-product-price-saved]",e)},priceNowLabel:{$span:t(".price-now-label",e)},priceLabel:{$span:t(".price-label",e)}}},a.clearPricingNotFound=function(t){t.rrpWithTax.$div.hide(),t.rrpWithoutTax.$div.hide(),t.nonSaleWithTax.$div.hide(),t.nonSaleWithoutTax.$div.hide(),t.priceSaved.$div.hide(),t.priceNowLabel.$span.hide(),t.priceLabel.$span.hide()},a.updatePriceView=function(t,e){this.clearPricingNotFound(t),e.with_tax&&(t.priceLabel.$span.show(),t.$priceWithTax.html(e.with_tax.formatted)),e.without_tax&&(t.priceLabel.$span.show(),t.$priceWithoutTax.html(e.without_tax.formatted)),e.rrp_with_tax&&(t.rrpWithTax.$div.show(),t.rrpWithTax.$span.html(e.rrp_with_tax.formatted)),e.rrp_without_tax&&(t.rrpWithoutTax.$div.show(),t.rrpWithoutTax.$span.html(e.rrp_without_tax.formatted)),e.saved&&(t.priceSaved.$div.show(),t.priceSaved.$span.html(e.saved.formatted)),e.non_sale_price_with_tax&&(t.priceLabel.$span.hide(),t.nonSaleWithTax.$div.show(),t.priceNowLabel.$span.show(),t.nonSaleWithTax.$span.html(e.non_sale_price_with_tax.formatted)),e.non_sale_price_without_tax&&(t.priceLabel.$span.hide(),t.nonSaleWithoutTax.$div.show(),t.priceNowLabel.$span.show(),t.nonSaleWithoutTax.$span.html(e.non_sale_price_without_tax.formatted))},e}();e.a=d}).call(this,a(4))}}]);
//# sourceMappingURL=theme-bundle.chunk.16.js.map