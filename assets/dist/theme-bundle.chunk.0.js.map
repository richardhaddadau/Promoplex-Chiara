{"version":3,"sources":["webpack://WebpackChiara/./assets/js/chiara/infinite-scroll.js"],"names":["InfiniteScroll","$scope","options","context","this","containerSelector","paginationSelector","nextLinkSelector","loadingClass","threshold","appendSelector","template","config","isRequesting","onScroll","bind","bindEvents","$","window","on","$pagination","$nextLink","length","top","offset","y1","scrollTop","y2","height","href","attr","replace","themeSettings","products_per_page","request","url","$container","addClass","api","getPage","err","resp","removeClass","$resp","$append","append","$newPagination","find","empty","children","initBrandPage","each","i","el","brand","products","limit","parseInt","initCategoryPage","category","initBrandsPage","brands","initSearchPage","product_results"],"mappings":"iXAGMA,E,WACF,WAAYC,EAAQC,EAASC,GAWzBC,KAAKF,QAAU,IAAS,GAVD,CACnBG,kBAAmB,eACnBC,mBAAoB,cACpBC,iBAAkB,0CAClBC,aAAc,aACdC,UAAW,IACXC,eAAgB,WAChBC,SAAU,uCACVC,OAAQ,IAEgCV,GAC5CE,KAAKH,OAASA,EACdG,KAAKD,QAAUA,EACfC,KAAKS,cAAe,EAEpBT,KAAKU,SAAWV,KAAKU,SAASC,KAAKX,MACnCA,KAAKY,a,2BAGTA,WAAA,WACIC,EAAEC,QAAQC,GAAG,SAAU,IAAWf,KAAKU,SAAU,O,EAGrDA,SAAA,WACI,IAAIV,KAAKS,aAAT,CAIA,IAAMO,EAAcH,EAAEb,KAAKF,QAAQI,mBAAoBF,KAAKH,QAEtDoB,EAAYJ,EAAEb,KAAKF,QAAQK,iBAAkBa,GACnD,GAAyB,IAArBC,EAAUC,OAAd,CAIA,IAAMC,EAAMF,EAAUG,SAASD,IAAMnB,KAAKF,QAAQO,UAC5CgB,EAAKR,EAAEC,QAAQQ,YACfC,EAAKF,EAAKR,EAAEC,QAAQU,SAE1B,GAAIL,GAAOE,GAAMF,GAAOI,EAAI,CACxB,IAAME,EAAOR,EAAUS,KAAK,QAAQC,QAAQ,iBAAkB,IAAjD,UAAiE3B,KAAKD,QAAQ6B,cAAcC,kBAEzG7B,KAAK8B,QAAQL,O,EAIrBK,QAAA,SAAQC,GAAK,WACHC,EAAanB,EAAEb,KAAKF,QAAQG,kBAAmBD,KAAKH,QACpDmB,EAAcH,EAAEb,KAAKF,QAAQI,mBAAoBF,KAAKH,QAE5DG,KAAKS,cAAe,EACpBO,EAAYiB,SAASjC,KAAKF,QAAQM,cAClC4B,EAAWC,SAASjC,KAAKF,QAAQM,cAEjC8B,IAAIC,QAAQJ,EAAK,CACbxB,SAAUP,KAAKF,QAAQS,SACvBC,OAAQR,KAAKF,QAAQU,SACtB,SAAC4B,EAAKC,GAKL,GAJA,EAAK5B,cAAe,EACpBO,EAAYsB,YAAY,EAAKxC,QAAQM,cACrC4B,EAAWM,YAAY,EAAKxC,QAAQM,cAEhCgC,EACA,OAAOA,EAGX,IAAMG,EAAQ1B,EAAEwB,GAEVG,EAAU3B,EAAE,EAAKf,QAAQQ,eAAgBiC,GAC3CC,EAAQtB,OAAS,GACjBc,EAAWS,OAAOD,GAGtB,IAAME,EAAiBH,EAAMI,KAAK,EAAK7C,QAAQI,oBAC/Cc,EACK4B,QACAH,OAAOC,EAAeG,gB,KAOhC,SAASC,EAAc/C,GAC1Bc,EAAE,gCAAgCkC,MAAK,SAACC,EAAGC,GACvC,IAAIrD,EAAeiB,EAAEoC,GAAK,CACtB1C,SAAU,oCACVC,OAAQ,CACJ0C,MAAO,CACHC,SAAU,CACNC,MAAOC,SAAStD,EAAQ6B,cAAcC,kBAAmB,QAItE9B,MAIJ,SAASuD,EAAiBvD,GAC7Bc,EAAE,mCAAmCkC,MAAK,SAACC,EAAGC,GAC1C,IAAIrD,EAAeiB,EAAEoC,GAAK,CACtBzC,OAAQ,CACJ+C,SAAU,CACNJ,SAAU,CACNC,MAAOC,SAAStD,EAAQ6B,cAAcC,kBAAmB,QAItE9B,MAIJ,SAASyD,EAAezD,GAC3Bc,EAAE,iCAAiCkC,MAAK,SAACC,EAAGC,GACtB,IAAIrD,EAAeiB,EAAEoC,GAAK,CACxChD,kBAAmB,aACnBK,eAAgB,SAChBC,SAAU,kCACVC,OAAQ,CACJiD,OAAQ,CACJL,MAAOC,SAAStD,EAAQ6B,cAAcC,kBAAmB,OAGlE9B,MAIJ,SAAS2D,EAAe3D,GAC3Bc,EAAE,iCAAiCkC,MAAK,SAACC,EAAGC,GACtB,IAAIrD,EAAeiB,EAAEoC,GAAK,CACxC1C,SAAU,qCACVC,OAAQ,CACJmD,gBAAiB,CACbP,MAAOC,SAAStD,EAAQ6B,cAAcC,kBAAmB,OAGlE9B,MAvDIH,a","file":"theme-bundle.chunk.0.js","sourcesContent":["import _ from 'lodash';\nimport { api } from '@bigcommerce/stencil-utils';\n\nclass InfiniteScroll {\n    constructor($scope, options, context) {\n        const defaultOptions = {\n            containerSelector: '.productGrid',\n            paginationSelector: '.pagination',\n            nextLinkSelector: '.pagination-item--next .pagination-link',\n            loadingClass: 'is-loading',\n            threshold: 100,\n            appendSelector: '.product',\n            template: 'chiara/category/ajax-product-listing',\n            config: {},\n        };\n        this.options = _.extend({}, defaultOptions, options);\n        this.$scope = $scope;\n        this.context = context;\n        this.isRequesting = false;\n\n        this.onScroll = this.onScroll.bind(this);\n        this.bindEvents();\n    }\n\n    bindEvents() {\n        $(window).on('scroll', _.debounce(this.onScroll, 200));\n    }\n\n    onScroll() {\n        if (this.isRequesting) {\n            return;\n        }\n\n        const $pagination = $(this.options.paginationSelector, this.$scope);\n\n        const $nextLink = $(this.options.nextLinkSelector, $pagination);\n        if ($nextLink.length === 0) {\n            return;\n        }\n\n        const top = $nextLink.offset().top - this.options.threshold;\n        const y1 = $(window).scrollTop();\n        const y2 = y1 + $(window).height();\n\n        if (top >= y1 && top <= y2) {\n            const href = $nextLink.attr('href').replace(/&?limit=[0-9]+/, '') + `&limit=${this.context.themeSettings.products_per_page}`;\n            \n            this.request(href);\n        }\n    }\n\n    request(url) {\n        const $container = $(this.options.containerSelector, this.$scope);\n        const $pagination = $(this.options.paginationSelector, this.$scope);\n\n        this.isRequesting = true;\n        $pagination.addClass(this.options.loadingClass);\n        $container.addClass(this.options.loadingClass);\n\n        api.getPage(url, {\n            template: this.options.template,\n            config: this.options.config,\n        }, (err, resp) => {\n            this.isRequesting = false;\n            $pagination.removeClass(this.options.loadingClass);\n            $container.removeClass(this.options.loadingClass);\n\n            if (err) {\n                return err;\n            }\n\n            const $resp = $(resp);\n\n            const $append = $(this.options.appendSelector, $resp);\n            if ($append.length > 0) {\n                $container.append($append);\n            }\n\n            const $newPagination = $resp.find(this.options.paginationSelector);\n            $pagination\n                .empty()\n                .append($newPagination.children());\n        });\n    }\n}\n\nexport default InfiniteScroll;\n\nexport function initBrandPage(context) {\n    $('[data-brand-infinite-scroll]').each((i, el) => {\n        new InfiniteScroll($(el), { // eslint-disable-line\n            template: 'chiara/brand/ajax-product-listing',\n            config: {\n                brand: {\n                    products: {\n                        limit: parseInt(context.themeSettings.products_per_page, 10),\n                    },\n                },\n            },\n        }, context);\n    });\n}\n\nexport function initCategoryPage(context) {\n    $('[data-category-infinite-scroll]').each((i, el) => {\n        new InfiniteScroll($(el), { // eslint-disable-line\n            config: {\n                category: {\n                    products: {\n                        limit: parseInt(context.themeSettings.products_per_page, 10),\n                    },\n                },\n            },\n        }, context);\n    });\n}\n\nexport function initBrandsPage(context) {\n    $('[data-brands-infinite-scroll]').each((i, el) => {\n        const infScroll = new InfiniteScroll($(el), { // eslint-disable-line\n            containerSelector: '.brandGrid',\n            appendSelector: '.brand',\n            template: 'chiara/brand/ajax-brand-listing',\n            config: {\n                brands: {\n                    limit: parseInt(context.themeSettings.products_per_page, 10),\n                },\n            },\n        }, context);\n    });\n}\n\nexport function initSearchPage(context) {\n    $('[data-search-infinite-scroll]').each((i, el) => {\n        const infScroll = new InfiniteScroll($(el), { // eslint-disable-line\n            template: 'chiara/search/ajax-product-listing',\n            config: {\n                product_results: {\n                    limit: parseInt(context.themeSettings.products_per_page, 10),\n                },\n            },\n        }, context);\n    });\n}\n"],"sourceRoot":""}